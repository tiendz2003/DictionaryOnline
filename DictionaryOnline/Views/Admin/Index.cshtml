@using DictionaryOnline.ViewModel
@model DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "_AdminLayout"; // We'll create this layout file next
}

<div class="container-fluid">
    <!-- Page title -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">Dashboard</h1>
        <a asp-controller="Dictionary" asp-action="Create" class="btn btn-primary">
            <i class="fas fa-plus"></i> Thêm từ mới
        </a>
    </div>

    <!-- Statistics cards -->
    <div class="statistics-container">
        <div class="dashboard-card">
            <div class="card-icon primary">
                <i class="fas fa-book"></i>
            </div>
            <h3>@(Model?.TotalDictionaries ?? 0)</h3>
            <p>Tổng số từ điển</p>
        </div>

        <div class="dashboard-card">
            <div class="card-icon success">
                <i class="fas fa-font"></i>
            </div>
            <h3>@(Model?.TotalWords ?? 0)</h3>
            <p>Tổng số từ vựng</p>
        </div>

        <div class="dashboard-card">
            <div class="card-icon warning">
                <i class="fas fa-users"></i>
            </div>
            <h3>@(Model?.TotalUsers ?? 0)</h3>
            <p>Người dùng đăng ký</p>
        </div>

        <div class="dashboard-card">
            <div class="card-icon danger">
                <i class="fas fa-search"></i>
            </div>
            <h3>@(Model?.RecentSearches?.Count ?? 0)</h3>
            <p>Lượt tra cứu gần đây</p>
        </div>
    </div>

    <div class="row">
        <!-- Quick search -->
        <div class="col-md-6 mb-4">
            <div class="dictionary-search">
                <h4>Tra cứu nhanh</h4>
                <form id="searchForm">
                    <div class="language-selector">
                        <select name="fromLang" class="form-select">
                            <option value="en">Tiếng Anh</option>
                            <option value="vi">Tiếng Việt</option>
                            <option value="fr">Tiếng Pháp</option>
                            <option value="de">Tiếng Đức</option>
                            <option value="ja">Tiếng Nhật</option>
                        </select>

                        <div class="language-switcher">
                            <i class="fas fa-exchange-alt"></i>
                        </div>

                        <select name="toLang" class="form-select">
                            <option value="vi">Tiếng Việt</option>
                            <option value="en">Tiếng Anh</option>
                            <option value="fr">Tiếng Pháp</option>
                            <option value="de">Tiếng Đức</option>
                            <option value="ja">Tiếng Nhật</option>
                        </select>
                    </div>

                    <div class="input-group mb-3">
                        <input type="text" id="searchTerm" name="term" class="form-control" placeholder="Nhập từ cần tra cứu...">
                        <button id="searchButton" class="btn btn-primary" type="submit">
                            <i class="fas fa-search"></i> Tra cứu
                        </button>
                    </div>
                </form>
                <div class="search-results" id="searchResults">
                    
                </div>
                        </div>
                  
            </div>
        </div>

        <!-- Recent activities -->
        <div class="col-md-6 mb-4">
            <div class="dashboard-card">
                <h4>Lịch sử tra cứu gần đây</h4>
                @if ( Model?.RecentSearches?.Any() == true)
                {
                    @foreach (var search in Model.RecentSearches)
                    {
                        <div class="activity-item">
                            <div class="activity-time">
                                @search.SearchDate.ToString("dd/MM/yyyy HH:mm")
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p>Chưa có lịch sử tra cứu</p>
                }
            </div>
        </div>
    </div>
<script>
    // Định nghĩa biến toàn cục
    window.searchUrl = '@Url.Action("Search", "Dictionary")';
</script>
<script src="~/js/admin.js"></script>
@* @section Scripts {
    <script>
        $(document).ready(function () {
            $("#searchForm").on("submit", function (e) {
                e.preventDefault(); // Ngăn form submit mặc định

                var term = $("#searchTerm").val();
                var fromLang = $("select[name='fromLang']").val();
                var toLang = $("select[name='toLang']").val();

                $.ajax({
                    url: window.searchUrl, // URL được định nghĩa trong script trước đó
                    type: "GET",
                    data: { term: term, fromLang: fromLang, toLang: toLang },
                    headers: { "X-Requested-With": "XMLHttpRequest" }, // Để trigger partial view
                    success: function (result) {
                        $("#searchResults").html(result); // Cập nhật kết quả vào div
                    },
                    error: function (xhr, status, error) {
                        $("#searchResults").html("<p class='text-danger'>Đã xảy ra lỗi khi tra cứu.</p>");
                    }
                });
            });
        });
    </script>
} *@